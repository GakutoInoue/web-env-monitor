# Raspberry Pi Temperature & Humidity Web Monitor

Raspberry PiとDHT11センサーを使用して、室内の温度・湿度を自動計測し、ブラウザ上で可視化するWebモニタリングシステムです。

![License](https://img.shields.io/badge/license-MIT-blue.svg)

## 📖 概要
このプロジェクトは、Raspberry Piを用いて環境データを収集し、Python (CGI) で動的にグラフを生成してWebブラウザに表示するシステムです。
現在はサンプルデータ (`sample.csv`) を元に可視化を行っていますが、実運用ではセンサーから取得したデータを1分間隔で蓄積しています。

## 💡 工夫した点

本システムの開発において、安定稼働とユーザビリティ向上のために以下の工夫を凝らしています。

### 1. データ収集の確実性
* **Crontabによる定期実行:**
    * Pythonの `time.sleep()` ループではなく、Linuxの `crontab` を採用しました。
    * **理由:** センサー読み取りエラー時のリトライ処理などで処理時間が伸びた場合でも、次回実行時刻が後ろ倒しにならず、正確に1分毎のデータ収集を行うためです。
* **センサー制御:**
    * DHT11センサーを使用し、温度と湿度を同時計測しています。

### 2. データの可視化技術
* **Matplotlibの活用:**
    * Pythonの `matplotlib` ライブラリを使用し、データを視覚的にわかりやすくグラフ化しています。
    * **2軸グラフの採用:** 温度（左軸・緑）と湿度（右軸・青）を一つのグラフにまとめつつ、スケールを分けることで相関関係を直感的に把握できるようにしました。
* **ヘッドレス環境への対応:**
    * `matplotlib.use('Agg')` を明示的に指定することで、ディスプレイを接続していないRaspberry Pi（CGI環境）でもエラーなく画像生成ができるようにしています。
* **直近データの抽出:**
    * 膨大なログデータから最新1時間分のみを自動抽出してプロットするロジックを組み込み、現在の状況を一目で判断できるようにしています。

### 3. Webフロントエンドの利便性
* **自動更新機能:**
    * HTMLの `<meta http-equiv="refresh">` タグにより、60秒ごとにページを自動リロードし、常に最新の状態を表示します。
* **キャッシュ対策:**
    * JavaScriptを使用し、画像URLの末尾にタイムスタンプを付与することで、ブラウザの強力なキャッシュ機能を回避し、更新された最新のグラフが必ず表示されるように実装しています。

## 🛠 技術スタック
* **Hardware:** Raspberry Pi, DHT11 Sensor
* **Language:** Python 3
* **Libraries:** Matplotlib, csv, datetime
* **Web Server:** Apache (CGI対応) / Webブラウザ

## 🚀 今後の展望
現在、以下の機能拡張システムを構築中です。

* **異常検知アラート機能:**
    * 温度や湿度が設定された規定値（閾値）を外れた場合、Webサーバーから管理者へ異常検知メールを自動送信する機能を実装予定です。

## 📝 実行方法
1. Webサーバー（Apacheなど）のCGIディレクトリに `update_graph.py` を配置し、実行権限を与えます。
2. ドキュメントルートに `index.html` と `sample.csv` を配置します。
3. ブラウザから `index.html` にアクセスするとグラフが表示されます。

---
Created by Gakuto Inoue

